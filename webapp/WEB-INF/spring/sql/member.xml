<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
	<!-- 20170307 김민지 회원가입insert -->
    <insert id="insertMember" parameterType="com.toy.user.model.MemberVo">
  		 INSERT INTO user
					(user_id,
					user_name,
					password)
		 VALUES
					(#{user_id},
					#{user_name},
					#{password})
    </insert>
     
     <!-- 20170324 김민지 사원 정보 가져오기  -->   
     <select id="getMyInfo" parameterType="String" resultType="com.toy.user.model.MemberDto" >
          select user_id
               ,user_name
        from user
        where user_id = #{user_id}
    </select>
    
    <!-- 20170324 김민지 사원정보 update -->
    <update id="updateMember" parameterType="com.toy.user.model.MemberVo">
          update user
        set  user_name = #{user_name}
             ,password = #{password}
        where user_id = #{user_id}        
    </update>
    
    <!-- 20170324 김민지 초기 권한 insert 코드 01 : ROLE_USER -->
    <insert id="insertUserAuth" parameterType="com.toy.user.model.MemberVo">
  		 INSERT INTO userauthority
					(user_id,
					auth_code)
		 VALUES
					(#{user_id},
					#{auth_code})
    </insert>
      <!-- 로그인 -->
    <select id="getUserLogin" parameterType="com.toy.user.model.MemberVo" resultType="com.toy.user.model.MemberDto">
    		SELECT user_id 
    			  , PASSWORD 
    			  , case enabled when '1' then 'true' else 'false' end as  enabled 
    	   FROM user 
    	   WHERE user_id = #{user_id}        
    </select>
    <!-- 로그인 권한 -->
     <select id="getUserLoginAuth" parameterType="com.toy.user.model.MemberVo" resultType="com.toy.user.model.MemberDto">
		    SELECT user.user_id, authority.auth_name 
				FROM user
				left join userauthority on userauthority.user_id = user.user_id 
				left join authority on authority.auth_code = userauthority.auth_code
			WHERE user.user_id = #{user_id}    
	</select>
</mapper>